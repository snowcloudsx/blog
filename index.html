<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>How to Make an OS</title>
    <style>
        /* Global Styles */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s, color 0.3s;
            flex-direction: column;
        }

        /* Light theme */
        .light-theme {
            background-color: #f5f5f5;
            color: #333;
        }

        /* Dark theme */
        .dark-theme {
            background-color: #181818;
            color: #fff;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 32px;
            margin: 0;
            padding: 0;
            font-weight: 700;
        }

        /* Author Info */
        .author-info {
            font-size: 18px;
            margin-bottom: 30px;
        }

        /* Moon Icon */
        .moon-icon {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 30px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .moon-icon:hover {
            transform: scale(1.2);
        }

        /* Markdown Area */
        .markdown-area {
            width: 90%;
            max-width: 800px;
            padding: 20px;
            background-color: #292929;
            color: #ccc;
            border-radius: 8px;
            font-family: 'Courier New', Courier, monospace;
            min-height: 200px;
            margin-top: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            .markdown-area {
                width: 95%;
            }
        }
    </style>
</head>
<body class="light-theme">
    <div class="header">
        <h1>How to Make an OS</h1>
        <div class="author-info">
            <p><strong>Author:</strong> Snowdev</p>
        </div>
    </div>

    <div class="markdown-area" id="markdown-area">
        <!-- This is where the Markdown content will be placed -->
      # Step 1:

### setting up the environment.

for this tutorial you will need a few things to start for now, a compiler and a emulator to run the OS in.
for this tutorial I will be using the nasm compiler and the qemu emulator as these programs provide support for multiple different OS's


lets start with installing nasm.

on Debian/Ubuntu based operating systems nasm can be installed simply with 

    sudo apt install nasm

for Fedora it can be installed with

    sudo dnf install nasm

and for Arch based distros it can be installed with 

    sudo pacman -S nasm

finally for macOS or brew it can be installed with

    brew install nasm


we will also need cmake for building our OS with all the compilers we will need later in the project
that can be installed with 
| Operating System | Command |
|--|--|
| Debian/Ubuntu | `sudo apt install cmake` |
| Fedora/RHEL   | `sudo dnf install cmake` |
| Arch Linux    | `sudo pacman -S cmake` |
| macOS (Homebrew) | `brew install cmake` |



after we have both of these installed you will need a IDE for writing the code in. there are many options but i can provide a few suggestions that i have used throughout this project.

first option is VS code. this is a IDE from Microsoft made for all operating systems and made to be lightweight if you don't want to use any of the other options for this guide then this is a great choice.


my other sugguestion would be neovim with Nvchad or Lazyvim installed. this turns neovim into a fully featured IDE. 

after you have all of this setup you will want to setup your project structure. For me it looks like this

```
Your OS Folder/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ main.asm
â”œâ”€â”€ build/
â”œâ”€â”€ tools/
â””â”€â”€ Makefile
```

you dont not have to follow this exactly if you do not want to but for the sake of the tutorial this will also coraspond to how i setup the makefiles and building so i do sugguest to follow it for atleast this first tutorial.

once you have your project setup and everything installed we can begin writing the code.


# Step 2

### setting up a simple VGA print.


our code will start with two lines:

```asm
org 0x7C00

bits 16
```

lets look at these two lines the `org 0x7C00`   tells the assembler to start placing the code at the memory address `0x7C00` which is a common starting point for operating systems.

the next line `bits 16` specifies that the program will be running in 16 bit mode which is used for coding in real mode.

here are the next few lines set up our main function  data segments and the stack

first we define our main function this will something like this

    main:
	    ; the rest of your code

After this, we set up the data segments. We need to do this because the program currently has no memory management, so we manually assign the data and extra segments to `0` to ensure the program can access memory properly.

    main:
		; setup data segments
	    mov ax, 0           ; can't set ds/es directly
	    mov ds, ax
	    mov es, ax
    
our next step will be setting up the stack we can do this simply with these two lines 

	    ; setup stack
	    mov ss, ax
	    mov sp, 0x7C00      ; stack grows downwards from where we are loaded in memory

the stack goes downwards so that's why we start it where we loaded into the memory.

we are currently defining our main function but we are never actually using it so we have to have our program jump there at the start we can do that like this 

    start:
	    jmp main

start is the entry point for our program so that is why we jmp to our main function from there.

by now our program should very similar to this
```
org 0x7C00
bits 16

start:
    jmp main


main:
    ; setup data segments
    mov ax, 0           ; can't set ds/es directly
    mov ds, ax
    mov es, ax
    
    ; setup stack
    mov ss, ax
    mov sp, 0x7C00      ; stack grows downwards from where we are loaded in memory


```

After this at the bottom of our file we will add these lines 
```
times 510-($-$$) db 0
dw 0AA55h
```

This code pads the bootloader to 512 bytes with zeros and adds the `0xAA55` boot signature at the end to mark it as a valid bootloader for the BIOS.

now we will make our puts function this "puts" a string into the output of our OS heres the code for that

```
puts:
    ; save registers we will modify
    push si
    push ax
    push bx

.loop:
    lodsb               ; loads next character in al
    or al, al           ; verify if next character is null?
    jz .done

    mov ah, 0x0E        ; call bios interrupt
    mov bh, 0           ; set page number to 0
    int 0x10

    jmp .loop

.done:
    pop bx
    pop ax
    pop si    
    ret
```

### **puts Function:**

The `puts` function prints a string to the screen character by character.

- First, it saves the registers (`SI`, `AX`, `BX`) that will be used, to ensure they are not modified by the function.
- It then enters a loop where it loads the next character of the string into the `AL` register using `lodsb` and checks if the character is null (possibly the end of the string).
- If the character is null, the loop ends and the function proceeds to restore the registers.
- If the character is not null, it uses the BIOS interrupt `0x10` to print the character to the screen.
- After printing all characters, the function restores the saved registers and exits.

this function makes sure that all of the characters are printed one after another and stops at the end of the string

now we get into the actual text we want to wright.

we can define that text in a variable like this.

    msg_hello: db 'Hello from your GoofyOS!', ENDL, 0

you will notice this uses the endl macro which we have not defined yet, we can do this at the top of the file with this line.

    %define ENDL 0x0D, 0x0A
this works because **`0x0D, 0x0A`**  are the hexadecimal values for the **carriage return (0x0D)** and **line feed (0x0A)**

our code is almost done now and currently looks like this

```
org 0x7C00
bits 16

%define ENDL 0x0D, 0x0A

start:
    jmp main

puts:
    ; save registers we will modify
    push si
    push ax
    push bx

.loop:
    lodsb               ; loads next character in al
    or al, al           ; verify if next character is null
    jz .done

    mov ah, 0x0E        
    mov bh, 0           
    int 0x10

    jmp .loop

.done:
    pop bx
    pop ax
    pop si    
    ret
    

main:
    ; setup data segments
    mov ax, 0           ; cant set ds/es directly
    mov ds, ax
    mov es, ax
    
    ; setup stack
    mov ss, ax
    mov sp, 0x7C00      ; stack grows downwards from where we load in from memory


msg_hello: db 'Hello world!', ENDL, 0


times 510-($-$$) db 0
dw 0AA55h

```
the only thing we are missing now is the actual function call. we can do that in out main function like this.

   ```
	  ; print hello message
	    mov si, msg_hello
	    call puts
```

this moves the msg_hello var to the si register which is what we use in our puts function.

there is one last thing we want to add to this code and that is to halt the cpu at the end of the program we can do that just like this at the very end of the main function

```
	; the rest of the main function 
   hlt

.halt:
    jmp .halt


```

that is all the code we will be doing for today but we're not done yet.




# Step 3

### setting up the makefile and running 

i will not go into alot of depth with this as if you are making a OS you most likely know how to use a makefile by now but i will provide mine for you.

```
ASM=nasm

SRC_DIR=src
BUILD_DIR=build

$(BUILD_DIR)/main_floppy.img: $(BUILD_DIR)/main.bin
	cp $(BUILD_DIR)/main.bin $(BUILD_DIR)/main_floppy.img
	truncate -s 1440k $(BUILD_DIR)/main_floppy.img
	
$(BUILD_DIR)/main.bin: $(SRC_DIR)/main.asm
	mkdir -p $(BUILD_DIR)
	$(ASM) $(SRC_DIR)/main.asm -f bin -o $(BUILD_DIR)/main.bin

```

this will change if your project structure is different then mine but if your following along this should work great.


our final thing we need to do is to setup a run file for quickly starting the OS. this will be a very simple file just one line but it will depend on your file structure but if your following along it will work fine.

    qemu-system-i386 -fda build/main_floppy.img -nographic

save this in a bash file for your os for linux and mac it will be .sh and for windows it will be .bat or .cmd.


# Finishing notes / credits

thank you for reading this it took me a good while to wright and it is going along with my journey in making my own OS i will gladly take any feedback about this and hope you have enjoyed.


#### credits to nanobyte on YouTube for his OS series that has taught me a lot about all of this.

    </div>

    <!-- Moon icon in the top-right corner -->
    <div class="moon-icon" id="themeToggle" onclick="toggleTheme()">
        ðŸŒ™
    </div>

    <script>
        // Function to toggle between light and dark themes
        function toggleTheme() {
            const body = document.body;
            const moonIcon = document.getElementById('themeToggle');

            // Check the current theme and toggle it
            if (body.classList.contains('light-theme')) {
                body.classList.remove('light-theme');
                body.classList.add('dark-theme');
                moonIcon.textContent = 'ðŸŒ•'; // Switch to sun icon for dark mode
            } else {
                body.classList.remove('dark-theme');
                body.classList.add('light-theme');
                moonIcon.textContent = 'ðŸŒ™'; // Switch back to moon icon for light mode
            }
        }
    </script>
</body>
</html>
